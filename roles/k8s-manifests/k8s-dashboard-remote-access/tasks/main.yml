---

- name: Ensure that kubernetes-dashboard namespace exists
  k8s:
    name: "{{ k8s_dashboard }}"
    api_version: v1
    kind: Namespace
    state: present

- name: Create an admin service account
  k8s:
    state: present
    definition:
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: admin-user
        namespace: "{{ k8s_dashboard }}"

- name: Create an admin user role
  k8s:
    state: present
    definition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: admin-user
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cluster-admin
      subjects:
        - kind: ServiceAccount
          name: admin-user
          namespace: "{{ k8s_dashboard }}"
